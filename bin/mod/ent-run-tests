#!/bin/bash

H() { echo -e "Runs the internal tests"; }
[ "$1" = "--help" ] && H && exit 0

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
cd "$DIR/../.." || {
  echo "Internal error: unable to find the script source dir" 1>&2
  exit
}
[ "$1" = "--cmplt" ] && exit 0

echo ""
_log_i "Starting the unit tests for OSTYPE: $OSTYPE"
(
  ent pro new _ent_autotest autotest autotest 2>/dev/null
  # shellcheck disable=SC1091
  . ent pro use _ent_autotest
  ent config --effective

  . s/_base.sh
  . s/tests/essentials.sh
  . s/tests/sys-utils-tests.sh
  . s/tests/utils-tests.sh
  . s/tests/var-utils-tests.sh
  . s/tests/quickstart-mocks-tests.sh

  . bin/mod/tests/ent-check-env-test.sh

  test_var_to_param
  test_check_ver_num
  test_is_ver_ge_ver
  test_map_functions
  test_index_of_arg
  test_path_functions
  test_shell_replacements
  test_utils_misc
  test_cfg_helper
  test_ask
  test_select_one
  test_args_or_ask
  test_asserters
  test_multipass_mocks
  test_spinner
  test_pkg_utils
) || _SOE
true
